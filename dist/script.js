"use strict";$(function(){$.get("./playlist.json").then(function(reponse){reponse.forEach(function(i){if(i.id<=6){var $li=recommendTemplate(i);$(".recommendList .recommendSongs").append($li)}else{return}});$(".recommendList .loading").remove()},function(error){alert(error)});$.get("./database.json").then(function(response){response.forEach(function(i){if(i.id>=7&&i.id<=16){var $li=newestTemplate(i);$(".newestList .newestSongs").append($li)}});$(".newestList .loading").remove()},function(error){alert(error)});$.get("./database.json").then(function(response){var index=0;response.forEach(function(i){var $li=void 0,$li2=void 0;if(i.isHot===1){index+=1;$li=hotSongsTemplate(i,index);$(".hotSongList .hotSongs").append($li)}else{$li2=hotSongsTemplate2(i);$(".hotSongList .hotSongs").append($li2)}});$(".hotSongList .loading").remove()},function(error){alert(error)});$.get("./database.json").then(function(response){response.forEach(function(i){if(i.isHot===2){var $li=$('<li><a class="link" href="./song.html?id='+i.id+'">'+i.hotSearch+"</a></li>");$(".records .hotList .hotSearch").append($li)}})},function(error){alert(error)})});function recommendTemplate(i){return $('<li>\n                    <a href="./playlist.html?id='+i.id+'">\n                         <div class="cover">\n                             <img src="'+i.cover+'" alt="推荐歌曲1"/>\n                             <span class="listener"><svg class="icon-headset"><use xlink:href="#icon-erjiicon"></use></svg>'+i.listener+'万</span>\n                         </div>\n                         <p class="remd-summary">'+i.title+"</p>\n                    </a>\n                </li>")}function newestTemplate(i){return $('<li>\n                   <a href="./song.html?id='+i.id+'">\n                        <div class="songInfo">\n                            <h3>'+i.name+'</h3>\n                            <div class="songIntroduce"><i class="icon-sq"> </i><span>'+i.singer+" - "+i.name+'</span></div>\n                        </div>\n                        <div class="playButton"><span></span></div>\n                   </a>\n               </li>')}function hotSongsTemplate(i,index){return $('<li>\n                   <a href="./song.html?id='+i.id+'">\n                        <div class="order song-hot">0'+index+'</div>\n                            <div class="songInfo">\n                                <h3>'+i.name+'<span></span></h3>\n                                <div class="songIntroduce"><i class="icon-sq"> </i><span>'+i.singer+" - "+i.name+'</span></div>\n                            </div>\n                        <div class="playButton"><span></span></div>\n                   </a>\n                </li>')}function hotSongsTemplate2(i){return $('<li>\n                   <a href="./song.html?id='+i.id+'">\n                        <div class="order">'+(i.id>=10?i.id:"0"+i.id)+'</div>\n                            <div class="songInfo">\n                                <h3>'+i.name+'<span></span></h3>\n                                <div class="songIntroduce"><i class="icon-sq"> </i><span>'+i.singer+" - "+i.name+'</span></div>\n                            </div>\n                        <div class="playButton"><span></span></div>\n                    </a>\n              </li>')}$(".tabs-nav").on("click","li",function(e){var $li=$(e.currentTarget);var index=$li.index();$li.addClass("active").siblings().removeClass("active");$(".tab-pannel").children().eq(index).addClass("active").siblings().removeClass("active")});var timer=null;$("input#search").on("input",function(e){if(timer){window.clearTimeout(timer)}timer=setTimeout(function(){timer=null;$(".records .hotList").removeClass("active");var value=$(e.currentTarget).val().trim();if(value===""){return}else{searchPrepare(value);ajax(value)}},400)});$(".clearInput").on("click",function(e){$("input#search").val("");$(".matchList").removeClass("active");$(".records").removeClass("active")});$("input#search").on("focus",function(e){$(".holder").empty()});function searchPrepare(value){$(".records").addClass("active");$(".matchTitle").remove();$(".searchResult").empty();$(".matchList").addClass("active");$(".matchList").prepend('<h3 class="matchTitle">搜索“'+value+"”</h3>")}function ajax(value){var request=initAjax();request.onload=function(){var data=parse(request);loadingSearch(data,value)};request.send()}function loadingSearch(data,value){for(var i=0;i<data.length;i++){if(data[i].name.includes(value)||data[i].singer===value||data[i].album.includes(value)){$(".searchResult").append(searchTemplate(data[i]));$(".records .history .history-Info").addClass("active").append(recordsTemplate(data[i]))}}}function searchTemplate(song){return $('<li data-id="'+song.id+'" onclick="chooseAjax('+song.id+')">\n                <a  href="javascript:void(0);">\n                    <svg class="icon-search"><use xlink:href="#icon-btnserach"></use></svg>\n                    <div class="matchItem"><div class="matchSongName">'+song.name+"</div></div>\n                </a>\n             </li>")}function chooseAjax(id){var request=initAjax();request.onload=function(){var data=parse(request);for(var i=0;i<data.length;i++){if(data[i].id===id){$(".matchTitle").remove();$(".searchResult").empty();$(".searchResult").append(resultTemplate(data[i]))}}};request.send()}function resultTemplate(song){return $('<li>\n                 <a  href="./song.html?id='+song.id+'">\n                     <div class="songInfo">\n                          <h3 class="highlight">'+song.name+'</h3>\n                              <div class="songIntroduce"><span>'+song.singer+" - "+song.name+'</span></div>\n                     </div>\n                     <div class="playButton"><span></span></div>\n                 </a>\n              </li>')}function recordsTemplate(song){return $('<li data-id="'+song.id+'">\n                 <svg class="icon-lishi"><use xlink:href="#icon-lishi"></use></svg>\n                 <div class="lishiInfo"><div class="lishiName"><a href="./song.html?id='+song.id+'">'+song.name+'</a></div></div>\n                 <svg class="icon-clear" onclick="clearRecords('+song.id+')"><use xlink:href="#icon-guanbixiao"></use></svg>\n             </li>')}function clearRecords(id){var li="li[data-id='"+id+"']";$(li).remove()}function initAjax(){var request=new XMLHttpRequest;request.open("GET","./database.json");request.setRequestHeader("Content-Type","application/json");return request}function parse(request){var data=JSON.parse(request.responseText);if(data===undefined){$(".searchResult").append('<p class="empty">没有找到结果</p>');return}return data}
