"use strict";$(function(){var id=parseInt(location.search.match(/\bid=([^&]*)/)[1],10);$.get("./database.json").then(function(response){var songs=response;var song=songs.filter(function(s){return s.id===id})[0];var url=song.url,name=song.name,singer=song.singer,lyric=song.lyric,pagebg=song.pagebg,cover=song.cover;play(url);initImg(pagebg,cover);initSongInfo(name,singer,lyric)},function(error){alert(error)});function play(url){var audio=document.createElement("audio");audio.src=url;document.body.appendChild(audio);$(".icon-play").on("click",function(){audio.play();add()});$(".icon-pause").on("click",function(){audio.pause();remove()});audio.onended=function(){remove()};setInterval(function(){var seconds=audio.currentTime;var munites=~~(seconds/60);var left=seconds-munites*60;var time=full(munites)+":"+full(left);var $lines=$(".lines > p");var $highlight=void 0;for(var i=0;i<$lines.length;i++){var currentLineTime=$lines.eq(i).attr("data-time");var nextLineTime=$lines.eq(i+1).attr("data-time");if($lines.eq(i+1).length!==0&&currentLineTime<time&&nextLineTime>time){$highlight=$lines.eq(i);break}}if($highlight){$highlight.addClass("active").prev().removeClass("active");var top=$highlight.offset().top;var linesTop=$(".lines").offset().top;var delta=top-linesTop-$(".lyric").height()/3;$(".lines").css("transform","translateY(-"+delta+"px)")}},300);function full(time){return time>=10?time+"":"0"+time}}function initSongInfo(name,singer,lyric){$(".song-description h1 .songName").text(name);$(".song-description h1 .author").text(singer);parseLyric.call(undefined,lyric)}function initImg(pagebg,cover){$(".page").css("background-image","url("+pagebg+")");$(".disc > .cover").removeAttr("src");$(".disc > .cover").attr("src",""+cover)}function parseLyric(lyric){var array=lyric.split("\n");var regex=/^\[(.+)\](.*)$/;array=array.map(function(string,index){var matche=string.match(regex);if(matche){return{time:matche[1],words:matche[2]}}});var $lines=$(".lines");array.map(function(object){if(!object){return}var $p=$("<p/>");$p.attr("data-time",object.time).text(object.words);$p.appendTo($lines)})}});function remove(){$(".disc .light").removeClass("playing");$(".disc .cover").removeClass("playing");$(".icon-wrap").removeClass("playing")}function add(){$(".disc .light").addClass("playing");$(".disc .cover").addClass("playing");$(".icon-wrap").addClass("playing")}
